#!/bin/bash

OUTPUT_FILENAME="nps_cupy_TIMES.t"

BACKEND="cupy"
COUNTER_TYPE="nps"

COUNTER_SIZES=(20000000 30000000 40000000 50000000 60000000 70000000 80000000 90000000 100000000 110000000 120000000 130000000 140000000 150000000)
CHUNK_SIZES=(7500000 10000000 12500000 15000000 17500000 20000000)

NUM_COUNTER_SIZES=${#COUNTER_SIZES[@]}
NUM_CHUNK_SIZES=${#CHUNK_SIZES[@]}
NUM_RUNS=$((NUM_COUNTER_SIZES * NUM_CHUNK_SIZES))

i=0
for CNTR_SIZE in "${COUNTER_SIZES[@]}"; do
  for CHNK_SIZE in "${CHUNK_SIZES[@]}"; do
    i=$((i + 1))
    printf "$i/$NUM_RUNS\r"
    python benchmark.py -backend "$BACKEND" -counter "$COUNTER_TYPE" -counter_size "$CNTR_SIZE" -chunk_size "$CHNK_SIZE" >> "$OUTPUT_FILENAME"
  done
done
printf "$i/$NUM_RUNS\n"

